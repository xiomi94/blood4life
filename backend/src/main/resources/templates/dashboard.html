<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood4Life Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        heading: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: '#2563eb', // blue-600
                        secondary: '#475569', // slate-600
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-100 font-sans min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-8">
        <h1 class="text-3xl sm:text-4xl font-heading font-bold text-gray-800 text-center mb-8">Blood Donor Statistics
        </h1>

        <div class="mb-8 flex justify-center">
            <div class="relative inline-block w-64">
                <label for="chartType" class="block text-sm font-medium text-gray-700 mb-2">Select Chart Type</label>
                <select id="chartType" onchange="updateChartVisibility()"
                    class="block w-full px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="bloodType">Blood Type Distribution</option>
                    <option value="gender">Gender Distribution</option>
                </select>
            </div>
        </div>

        <div class="relative h-[400px] w-full" id="bloodTypeChartContainer">
            <canvas id="bloodTypeChart"></canvas>
        </div>
        <div class="relative h-[400px] w-full hidden" id="genderChartContainer">
            <canvas id="genderChart"></canvas>
        </div>

        <div class="mt-8 text-center">
            <a href="/" class="text-blue-600 hover:text-blue-800 underline font-medium">Back to Home</a>
        </div>
    </div>

    <script th:inline="javascript">

        var bloodTypeLabels = /*[[${bloodTypeLabels}]]*/[];
        var bloodTypeCounts = /*[[${bloodTypeCounts}]]*/[];
        var genderLabels = /*[[${genderLabels}]]*/[];
        var genderCounts = /*[[${genderCounts}]]*/[];

        // Common Chart Options
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: {
                            family: "'Roboto', sans-serif",
                            size: 12
                        }
                    }
                }
            }
        };

        // Blood Type Chart
        var ctxBlood = document.getElementById('bloodTypeChart').getContext('2d');
        var bloodTypeChart = new Chart(ctxBlood, {
            type: 'bar',
            data: {
                labels: bloodTypeLabels,
                datasets: [{
                    label: 'Number of Donors',
                    data: bloodTypeCounts,
                    backgroundColor: 'rgba(37, 99, 235, 0.6)', // blue-600
                    borderColor: 'rgba(37, 99, 235, 1)',
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Gender Chart
        var ctxGender = document.getElementById('genderChart').getContext('2d');
        var genderChart = new Chart(ctxGender, {
            type: 'doughnut', // Changed to doughnut for modern look
            data: {
                labels: genderLabels,
                datasets: [{
                    label: 'Gender Distribution',
                    data: genderCounts,
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.6)', // blue-500
                        'rgba(236, 72, 153, 0.6)', // pink-500
                        'rgba(107, 114, 128, 0.6)'  // gray-500
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(236, 72, 153, 1)',
                        'rgba(107, 114, 128, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: commonOptions
        });

        function updateChartVisibility() {
            var selected = document.getElementById('chartType').value;
            var bloodChart = document.getElementById('bloodTypeChartContainer');
            var genderChart = document.getElementById('genderChartContainer');

            if (selected === 'bloodType') {
                bloodChart.classList.remove('hidden');
                genderChart.classList.add('hidden');
            } else {
                bloodChart.classList.add('hidden');
                genderChart.classList.remove('hidden');
            }
        }
        /*]]>*/
    </script>

</body>

</html>